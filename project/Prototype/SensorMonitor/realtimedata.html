<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>realtimedata</title>
  <!--引入 jquery.js-->
  <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js">
  </script>
  <!-- 引入 echarts.js -->
  <!--<script type="text/javascript" src="https://echarts.baidu.com/gallery/vendors/echarts/echarts-all-3.js"></script>-->
  <!-- <script type="text/javascript" src="../js/echarts.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <style>
    .container {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      padding: 80px 30px;
    }

    .marg {
      margin: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <script type="text/javascript">
      function send(callback_with_data, deviceName, id, maxn) {
        $.ajax({
          url: "/jsonData/" + deviceName + "/" + maxn,
          dataType: "json",
          async: "true",
          success: function (data) {
            console.log(JSON.stringify(data.data))
            callback_with_data(data.data, id)
          },

          error: function () {

          }
        });
      }
      function sendtest() {
        var output = []
        d = { "angleY": "17.699", "angleZ": "-121.959", "time": "2023-03-13+12:14:37.676", "asY": "0.183", "accX": "-0.304", "asZ": "0.000", "asX": "-0.244", "angleX": "3.867", "accZ": "0.951", "accY": "0.065" }
        for (var i = 1; i <= 120; i++) {
          output.push(d)
        }
        return output;

      }
      function show(myChart, titlename, datax, datay, dataz, xlable, minv, maxv) {

        option = {

          color: ['#80FFA5', '#37A2FF', '#FF0087'],
          title: {
            text: titlename,
            textStyle: {
              color: '#FF4500',
              fontFamily: 'sans-serif',
            }
          },
          tooltip: {
            trigger: 'axis',
            axisPointer: {
              type: 'cross',
              label: {
                backgroundColor: '#6a7985'
              }
            }
          },
          legend: {
            show: true,
            top: "10%",
            data: ['X', 'Y', 'Z']
          },
          toolbox: {
            feature: {
              saveAsImage: {}
            }
          },
          grid: {
            left: '15%',
          },
          xAxis: [
            {
              type: 'category',
              boundaryGap: false,
              data: xlable
            }
          ],
          yAxis: [
            {
              type: 'value',
              min: minv,
              max: maxv,
              scale: false
            }
          ],
          series: [
            {
              name: 'X',
              type: 'line',
              smooth: true,
              lineStyle: {
                width: 2
              },
              showSymbol: false,

              emphasis: {
                focus: 'series'
              },
              data: datax
            },
            {
              name: 'Y',
              type: 'line',
              smooth: true,
              lineStyle: {
                width: 2
              },
              showSymbol: false,
              emphasis: {
                focus: 'series'
              },
              data: datay
            },
            {
              name: 'Z',
              type: 'line',
              smooth: true,
              lineStyle: {
                width: 2
              },
              showSymbol: false,
              label: {

                position: 'top'
              },
              emphasis: {
                focus: 'series'
              },
              data: dataz
            }
          ]
        };
        option && myChart.setOption(option);
      }

    </script>
    <div id="mainan1" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainas1" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainac1" style="width: 300px;height:300px;" class="marg"></div>

    <div id="mainan2" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainas2" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainac2" style="width: 300px;height:300px;" class="marg"></div>

    <div id="mainan3" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainas3" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainac3" style="width: 300px;height:300px;" class="marg"></div>

    <div id="mainan4" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainas4" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainac4" style="width: 300px;height:300px;" class="marg"></div>

    <div id="mainan5" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainas5" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainac5" style="width: 300px;height:300px;" class="marg"></div>

    <div id="mainan6" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainas6" style="width: 300px;height:300px;" class="marg"></div>
    <div id="mainac6" style="width: 300px;height:300px;" class="marg"></div>

    <script type="text/javascript">
      var myChart = [[], [], [], [], [], []]
      var chartDoman1 = document.getElementById('mainan1');
      var myChartan1 = echarts.init(chartDoman1);
      var chartDomas1 = document.getElementById('mainas1');
      var myChartas1 = echarts.init(chartDomas1);
      var chartDomac1 = document.getElementById('mainac1');
      var myChartac1 = echarts.init(chartDomac1);
      myChart[0] = [myChartan1, myChartas1, myChartac1]

      var chartDoman2 = document.getElementById('mainan2');
      var myChartan2 = echarts.init(chartDoman2);
      var chartDomas2 = document.getElementById('mainas2');
      var myChartas2 = echarts.init(chartDomas2);
      var chartDomac2 = document.getElementById('mainac2');
      var myChartac2 = echarts.init(chartDomac2);
      myChart[1] = [myChartan2, myChartas2, myChartac2]

      var chartDoman3 = document.getElementById('mainan3');
      var myChartan3 = echarts.init(chartDoman3);
      var chartDomas3 = document.getElementById('mainas3');
      var myChartas3 = echarts.init(chartDomas3);
      var chartDomac3 = document.getElementById('mainac3');
      var myChartac3 = echarts.init(chartDomac3);
      myChart[2] = [myChartan3, myChartas3, myChartac3]

      var chartDoman4 = document.getElementById('mainan4');
      var myChartan4 = echarts.init(chartDoman4);
      var chartDomas4 = document.getElementById('mainas4');
      var myChartas4 = echarts.init(chartDomas4);
      var chartDomac4 = document.getElementById('mainac4');
      var myChartac4 = echarts.init(chartDomac4);
      myChart[3] = [myChartan4, myChartas4, myChartac4]

      var chartDoman5 = document.getElementById('mainan5');
      var myChartan5 = echarts.init(chartDoman5);
      var chartDomas5 = document.getElementById('mainas5');
      var myChartas5 = echarts.init(chartDomas5);
      var chartDomac5 = document.getElementById('mainac5');
      var myChartac5 = echarts.init(chartDomac5);
      myChart[4] = [myChartan5, myChartas5, myChartac5]

      var chartDoman6 = document.getElementById('mainan6');
      var myChartan6 = echarts.init(chartDoman6);
      var chartDomas6 = document.getElementById('mainas6');
      var myChartas6 = echarts.init(chartDomas6);
      var chartDomac6 = document.getElementById('mainac6');
      var myChartac6 = echarts.init(chartDomac6);
      myChart[5] = [myChartan6, myChartas6, myChartac6]

      devicename = [
        "WT901-L1_v0.0.1",
        "WT901-L2_v0.0.1",
        "WT901-L3_v0.0.1",
        "WT901-R1_v0.0.1",
        "WT901-R2_v0.0.1",
        "WT901-R3_v0.0.1",
      ]
      var anglex = [[], [], [], [], [], []]
      var angley = [[], [], [], [], [], []]
      var anglez = [[], [], [], [], [], []]

      var asx = [[], [], [], [], [], []]
      var asy = [[], [], [], [], [], []]
      var asz = [[], [], [], [], [], []]

      var accx = [[], [], [], [], [], []]
      var accy = [[], [], [], [], [], []]
      var accz = [[], [], [], [], [], []]
      var thresh = [0, 0, 0, 0, 0, 0]
      var xlable = [[], [], [], [], [], []]
      var t = [0, 0, 0, 0, 0, 0]
      for (var i = 0; i < 6; i++) {
        data = send(function (data, i) {
          for (var ii in data) {
            date = data[ii].time
            day = parseInt(date.substr(8, 10))
            hour = parseInt(date.substring(11, 13))
            min = parseInt(date.substring(14, 16))
            sec = parseInt(date.substring(17, 19))
            msec = parseInt(date.substring(20, 22))
            time = msec + 1000 * (sec + 60 * (min + 60 * (hour + 24 * day)))
            if (time <= thresh[i]) continue
            thresh[i] = time
            d = data[ii]
            xlable[i].push(parseInt(t[i]++))

            anglex[i].push(parseFloat(d.angleX))
            angley[i].push(parseFloat(d.angleY))
            anglez[i].push(parseFloat(d.angleZ))

            asx[i].push(parseFloat(d.asX))
            asy[i].push(parseFloat(d.asY))
            asz[i].push(parseFloat(d.asZ))

            accx[i].push(parseFloat(d.accX))
            accy[i].push(parseFloat(d.accY))
            accz[i].push(parseFloat(d.accZ))
          }
        }, devicename[i], i, 20)
      }

      function getDeviceName(name) {
        return name.substr(6, 2);
      }

      setInterval(function () {
        var i;
        for (i = 0; i < 6; i++) {
          // alert(i)
          data = send(function (data, i) {
            for (var ii in data) {
              date = data[ii].time
              day = parseInt(date.substr(8, 10))
              hour = parseInt(date.substring(11, 13))
              min = parseInt(date.substring(14, 16))
              sec = parseInt(date.substring(17, 19))
              msec = parseInt(date.substring(20, 22))
              time = msec + 1000 * (sec + 60 * (min + 60 * (hour + 24 * day)))
              if (time <= thresh[i]) continue
              thresh[i] = time
              d = data[ii]
              xlable[i].shift()
              xlable[i].push(parseInt(t[i]++))
              t[i] %= 10000

              anglex[i].shift()
              anglex[i].push(parseFloat(d.angleX))
              angley[i].shift()
              angley[i].push(parseFloat(d.angleY))
              anglez[i].shift()
              anglez[i].push(parseFloat(d.angleZ))

              asx[i].shift()
              asx[i].push(parseFloat(d.asX))
              asy[i].shift()
              asy[i].push(parseFloat(d.asY))
              asz[i].shift()
              asz[i].push(parseFloat(d.asZ))
              
              accx[i].shift()
              accx[i].push(parseFloat(d.accX))
              accy[i].shift()
              accy[i].push(parseFloat(d.accY))
              accz[i].shift()
              accz[i].push(parseFloat(d.accZ))
            }
          }, devicename[i], i, 1)
          name_now = getDeviceName(devicename[i])
          show(myChart[i][0], name_now + " Angle", anglex[i], angley[i], anglez[i], xlable[i], -180, 180),
          show(myChart[i][1], name_now + " As", asx[i], asy[i], asz[i], xlable[i], -300, 300),
          show(myChart[i][2], name_now + " Acc", accx[i], accy[i], accz[i], xlable[i], -1.2, 1.2)
        }

      }, 200);
    </script>
  </div>
  <!-- 为ECharts准备一个具备大小（宽高）的Dom -->

</body>

</html>